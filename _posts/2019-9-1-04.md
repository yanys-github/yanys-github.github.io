---
layout: post
title: 事件循环
categories: javascript
author: yanys
---

* content
{:toc}

- 简介
- 宏任务与微任务
- promise.then()，setTimeout()相关异步执行顺序



## 简介
异步任务的回调部分交给事件循环，等时机合适交还给JS线程执行。  
事件循环是由一个队列组成的，异步任务的回调遵循先进先出，在JS引擎空闲时会一轮一轮地被取出，所以被叫做循环。  
事件循环由宏任务和在执行宏任务期间产生的所有微任务组成。完成当下的宏任务后，会立刻执行所有在此期间入队的微任务。

## 为什么分两种任务
为了给紧急任务一个插队的机会，否则新入队的任务永远被放在队尾。  
本轮循环中的微任务实际上就是在插队，这样微任务中所做的状态修改，在下一轮事件循环中也能得到同步。

## promise.then()，setTimeout()相关异步执行顺序
首先：第一个 script 标签的同步代码作为第一个宏任务执行，并将在此期间得到的异步函数放到事件循环（包括宏任务和微任务）中，执行完后，将当前的微任务队列清空。再执行下一宏任务依次循环直到执行完毕。
补充：
1Promise 执行器中的代码会被同步调用，但是回调是基于微任务的。